<!doctype html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
        .flex-class {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      
    }
  </style>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <script src="https://cdn.ckeditor.com/ckeditor5/29.2.0/classic/ckeditor.js"></script>
  <title>Editor</title>
</head>

<body>
  <%- include('partials/navbar2') %>


  <!-- <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight">PDF files</button> -->

  <div class="container flex-class">

 
    <div class="editorContainer">
      <form id="myform">
        <div id="editor">
          <p>This is some sample content.</p>
        </div>
        <button class="btn-primary" type="submit">Submit</button>
      </form>
    </div>

 


   

    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
      <div class="offcanvas-header">
        <h5 id="offcanvasRightLabel">Offcanvas right</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body">
        
        <div class="filesContainer">
          
          <%let fileNum=0%>
          <% userInfo.subjects[subjectNum].subject.chapters[chapterNum].files.forEach(file=>{ %>
            <% let url='/test/'+subjectNum+","+chapterNum+","+fileNum%>


            <div class="alert alert-primary" role="alert">
              <a href=<%=url%>> <b> <i> <%=file.name%></i></b></a>
            </div>

            
            <%fileNum=fileNum+1%>
            <% }) %>
        </div>
      </div>
    </div>


    <div class="container" style="width:20px">
      <% url="/files/"+subjectNum+","+chapterNum %>
      <form id="uploadFile" action=<%=url %> method="POST" enctype="multipart/form-data">
        <input type="text" name="documentName" id="documentName" placeholder="File name"/>
        <input type="file" name="userFile" />
        <button type="submit" class="btn btn-primary" >upload</button>
      </form>
    </div>


   

  </div>






    <!-- <% url="/filesOfchapter/"+subjectNum+","+chapterNum %>

    <button type="button" class="btn btn-outline-primary"> <a href=<%=url%>>Files </a> </button> -->


    <script>

document.getElementById('PDF_Files').style.display = "block"

      ClassicEditor
        .create(document.querySelector('#editor'))
        .catch(error => {
          console.error(error);
        });

      let subjectNum = '<%-subjectNum%>'
      let chapterNum = '<%-chapterNum%>'
      document.getElementById("myform").onsubmit = (e) => {

        console.log(e.target)
        let url = "https://studdy-buddyy.herokuapp.com/" + subjectNum + "," + chapterNum
        let data = new URLSearchParams()

        let userDocuments = document.querySelector('.ck-content').innerHTML
        data.append("data", userDocuments)
        fetch(url, {
          method: "post",
          body: data,

        }).then(res => res.text())
          .then(result => {
            document.write(result)
          }).catch(err => console.log(err))

          
      }



/////////////////////////////////////////////////////////


// document.getElementById("uploadFile").onsubmit=(e)=>{
//                 e.preventDefault()
//                 console.log(e.target)
//                 let  url="http://localhost:3000/files/"+subjectNum+","+chapterNum
//                 let data=new URLSearchParams()
               
//                 for(const pair of new FormData(e.target) ){
                    
//                     data.append(pair[0],pair[1])
//                 }
//                 fetch(url,{
//                     method:"post",
//                     body:data,

//                 }).then(res=>res.json())
//                 .then(result=>{
//                     console.log(result)
                  
//                 })
//                 // location.reload()
//             }








/////////////////////////////////////////////////////////
      
    </script>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
      crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js" integrity="sha384-W8fXfP3gkOKtndU4JGtKDvXbO53Wy8SZCQHczT5FMiiqmQfUpWbYdTil/SxwZgAN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" integrity="sha384-skAcpIdS7UcVUC05LJ9Dxay8AXcDYfBJqt1CJ85S/CFujBsIzCIv+l9liuYLaMQ/" crossorigin="anonymous"></script>
    -->
</body>

</html>